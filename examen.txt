use jardineria;
delimiter //
drop procedure if exists ActualizarFecha//
create procedure ActualizarFecha ()
begin
#declaramos variables
declare fech varchar(50);
declare vid_transaccion varchar(50);
declare local_hecho varchar(50);
#declaramos cursor
DECLARE act_fecha CURSOR FOR select id_transaccion from pago;
declare continue handler for not found set local_hecho = 1;
select max(fecha_pago) into fech from pago;
#abrimos cursor
open act_fecha;
#recorremos cursor con el bucle loop
loop_act: LOOP
fetch act_fecha into vid_transaccion;
if local_hecho = 1 then leave loop_act;
end if;
end loop;
end //
#extraemos el a√±o maximo de la tabla
select extract( year from (max(fecha_pago))) from pago;

drop event if exists eventoanio//
create event eventoanio on schedule
every 1 year
starts "2021-12-31 00:01:00"
ends "2023-12-31 00:01:00"
do call Actualizar_fechas();
delimiter ;
